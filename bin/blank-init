#! /usr/bin/env bash

# Initialize a new repository. This boils down to `git init --bare`.
#
# Example usage:
#
#   blank-init alice/hello

USER_NAME="$(echo $1 | cut -d / -f 1)"
REPO_NAME="$(echo $1 | cut -d / -f 2)"

echo "blank-int Called with $1" >> /blank/blank.log

if [[ -z "${REPO_NAME}" ]] ; then
  echo "Usage: blank-init USER_NAME/REPO"
  exit 1
fi

REPO_BASENAME=$(basename -- "${REPO_NAME}")

if [[ "${REPO_NAME}" != "${REPO_BASENAME}" ]] ; then
  echo "The repository name can't be a path."
  exit 1
fi

REPO_PATH="/blank/repos/${USER_NAME}/${REPO_NAME}.git"

git init --bare "${REPO_PATH}"
cat >> "${REPO_PATH}/config" <<EOF
[user]
	email = ${USER_NAME}@users.noreply.reesd.com
	name = ${USER_NAME}
EOF
